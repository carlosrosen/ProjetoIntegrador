{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>U-Balance - Detalhes do Objetivo</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'core/css/style_dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'objetivos/css/objetivos-detalhes.css' %}" />
    <link rel="stylesheet" href="{% static 'objetivos/css/modais-detalhes.css' %}" />
</head>
<body>
  <aside class="sidebar">
    <h1>U-Balance</h1>
    <nav>
      <a href="{% url 'core:dashboard' %}">üè† In√≠cio</a>
      <a href="#" id="abrirModalTransacao">üí≤ Adicionar Transa√ß√£o</a>
      <a href="#" id="abrirModalMeta">üéØ Adicionar Meta</a>
      <a href="#" id="abrirModalObjetivo">üìà Adicionar Objetivo</a>
      <a href="{% url 'core:metas:meta' %}">üéØ Metas</a>
      <a href="{% url 'core:objetivos:menu_objetivos' %}" style="background-color: #f0f0f0; font-weight: 600;">üìà Objetivos</a>
      <a href="#">üßæ Extrato</a>
      <a href="#">üìä Relat√≥rios</a>
      <a href="#">‚öôÔ∏è Configura√ß√µes</a>
      <a href="{% url 'usuario:logout' %}" id="logout">Logout</a>
    </nav>
  </aside>
  <main class="content">
    <div class="objetivo-header">
      <h1 id="tituloObjetivo">{{ objetivo.titulo }}</h1>
      <div class="usuario-info">Usu√°rio: {{ username }}</div>
    </div>
    <div class="acoes-container">
      <button class="btn-acao btn-deposito" onclick="location.hash = '#deposito'">Dep√≥sito</button>
      <button class="btn-acao btn-resgate" onclick="location.hash = '#resgate'">Resgate</button>
      <button class="btn-acao btn-apagar" onclick="location.hash = '#apagar'">Apagar</button>
      <button class="btn-acao btn-editar" onclick="location.hash = '#editar'">
        <span class="icon-editar" style="color: white;">Editar</span>
      </button>
    </div>
    <div class="conteudo-principal">
      <div class="painel-esquerdo">
        <div class="historico-container">
          <h3>Hist√≥rico de transa√ß√µes do objetivo</h3>
          <div class="tabela-container">
            <table class="tabela-historico">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Tipo da opera√ß√£o</th>
                  <th>Valor</th>
                </tr>
              </thead>
              <tbody id="historicoTransacoes">
                {% for transacao in objetivo.transacoes %}
                <tr>
                  <td>{{ transacao.data|date:"d/m/Y" }}</td>
                  <td>{{ transacao.tipo }}</td>
                  <td class="{% if transacao.tipo == 'D' %}valor-positivo{% else %}valor-negativo{% endif %}">
                    {% if transacao.tipo == 'D' %}+{% else %}-{% endif %}R$ {{ transacao.valor|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="3">Nenhuma transa√ß√£o encontrada.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="ordem-info">
            <span class="seta-ordem">‚ñº</span>
            Em ordem de data
          </div>
        </div>
      </div>
      <div class="painel-direito">
        <div class="grafico-container">
          <h3>Gr√°fico da varia√ß√£o do saldo do objetivo</h3>
          <div class="grafico-area">
            <canvas id="graficoVariacao"></canvas>
          </div>
        </div>
        <div class="informacoes-container">
          <h3>Informa√ß√µes do objetivo</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Valor guardado:</span>
              <span class="info-valor valor-guardado">R$ {{ objetivo.valor_guardado|floatformat:2 }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Valor objetivo:</span>
              <span class="info-valor">R$ {{ objetivo.valor_objetivo|floatformat:2 }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Status:</span>
              <span class="info-valor {% if objetivo.status == 'Ativo' %}status-ativo{% else %}status-inativo{% endif %}">{{ objetivo.status }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Progresso:</span>
              <span class="info-valor">{{ objetivo.progresso }}%</span>
            </div>
            <div class="info-item">
              <span class="info-label">Data limite:</span>
              <span class="info-valor">{{ objetivo.data_limite|date:"d/m/Y" }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
<div id="modalDeposito" class="modal">
  <div class="modal-content">
    <h2>Fazer Dep√≥sito</h2>
    <form id="formDeposito" method="post" action="{% url 'adicionar_deposito' objetivo.id %}">
      {% csrf_token %}
      <label for="valorDeposito">Valor a depositar:</label>
      <input type="number" name="valorDeposito" step="0.01" min="0" required>
      <div style="text-align:right;">
        <button type="submit" class="btn-salvar">Confirmar</button>
        <button type="button" class="btn-cancelar" onclick="fecharModalHash()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
<div id="modalResgate" class="modal">
  <div class="modal-content">
    <h2>Fazer Resgate</h2>
    <form id="formResgate" method="post" action="{% url 'adicionar_resgate' objetivo.id %}">
      {% csrf_token %}
      <label for="valorResgate">Valor a resgatar:</label>
      <input type="number" name="valorResgate" step="0.01" min="0" required>
      <div style="text-align:right;">
        <button type="submit" class="btn-salvar">Confirmar</button>
        <button type="button" class="btn-cancelar" onclick="fecharModalHash()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
<div id="modalEditar" class="modal">
  <div class="modal-content">
    <h2>Editar Objetivo</h2>
    <form id="formEditar" method="post" action="{% url 'editar_objetivo' objetivo.id %}">
      {% csrf_token %}
      <label for="novoTitulo">Novo T√≠tulo:</label>
      <input type="text" name="novoTitulo" value="{{ objetivo.titulo }}" required>

      <label for="novoValor">Novo Valor do Objetivo:</label>
      <input type="number" name="novoValor" step="0.01" min="0" value="{{ objetivo.valor_objetivo }}" required>

      <label for="novaData">Nova Data Final:</label>
      <input type="date" name="novaData" value="{{ objetivo.data_limite|date:'Y-m-d' }}" required>

      <div style="text-align:right;">
        <button type="submit" class="btn-salvar">Salvar</button>
        <button type="button" class="btn-cancelar" onclick="fecharModalHash()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
<div id="modalApagar" class="modal">
  <div class="modal-content">
    <h2>Apagar Objetivo</h2>
    <p>Tem certeza que deseja apagar este objetivo? Esta a√ß√£o n√£o pode ser desfeita.</p>
    <div style="text-align:right;">
      <form method="post" action="{% url 'apagar_objetivo' objetivo.id %}">
        {% csrf_token %}
        <button type="submit" class="btn-salvar">Confirmar</button>
        <button type="button" class="btn-cancelar" onclick="fecharModalHash()">Cancelar</button>
      </form>
    </div>
  </div>
</div>
  <script src="{% static 'objetivos/js/script-detalhe.js' %}" defer></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
  const ctx = document.getElementById('graficoVariacao').getContext('2d');
  const monthsLabels = []
  const saldoData = []

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: monthsLabels,
      datasets: [{
        label: 'Varia√ß√£o do saldo',
        data: saldoData,
        backgroundColor: 'rgba(26, 191, 99, 0.7)',
        borderColor: 'rgba(26, 191, 99, 1)',
        borderWidth: 1,
        borderRadius: 5
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
          }
        }
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              let val = context.parsed.y;
              return 'R$ ' + val.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
          }
        }
      }
    }
  });
});
</script>
</body>
</html>

