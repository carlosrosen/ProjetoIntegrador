{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>U-Balance - Extrato de Transa√ß√µes</title>
  <link rel="stylesheet" href="{% static 'extrato/css/extrato.css' %}" />
  <link rel="stylesheet" href="{% static 'core/css/style_dashboard.css' %}" />
</head>
<body>
  <aside class="sidebar">
    <h1>U-Balance</h1>
    <nav>
      <a href="{% url 'core:dashboard' %}">üè† In√≠cio</a>
      <a href="#" id="abrirModalTransacao">üí≤ Adicionar Transa√ß√£o</a>
      <a href="#" id="abrirModalMeta">üéØ Adicionar Meta</a>
      <a href="#" id="abrirModalObjetivo">üìà Adicionar Objetivo</a>
      <a href="{% url 'core:metas:meta' %}">üéØ Metas</a>
      <a href="{% url 'core:objetivos:menu_objetivos' %}">üìà Objetivos</a>
      <a href="#" class="active">üßæ Extrato</a>
      <a href="#">üìä Relat√≥rios</a>
      <a href="#">‚öôÔ∏è Configura√ß√µes</a>
      <a href="{% url 'usuario:logout' %}" id="logout">Logout</a>
    </nav>
  </aside>

  <main class="content">
    <div class="top-bar">
      <div>
        <h2 class="page-subtitle">Extrato de Transa√ß√µes</h2>
        <h1 class="page-title">Extrato de {{ mes_nome }}/{{ ano }}</h1>
      </div>
      <div class="user-info">
        <span>Usu√°rio: {{ username }}</span>
      </div>
    </div>

    <div class="summary-cards">
      <div class="summary-card balance">
        <h3>SALDO DO M√äS</h3>
        <p class="amount">R$ {{ saldo_mes|floatformat:2 }}</p>
      </div>
      <div class="summary-card income">
        <h3>RECEITAS DO M√äS</h3>
        <p class="amount">R$ {{ receitas_mes|floatformat:2 }}</p>
      </div>
      <div class="summary-card expense">
        <h3>DESPESAS DO M√äS</h3>
        <p class="amount">R$ {{ despesas_mes|floatformat:2 }}</p>
      </div>
    </div>

    <form method="POST" class="filters-section">
      {% csrf_token %}
      <div class="filters">
        <select name="mes" id="mes">
          <option value="janeiro">Janeiro</option>
          <option value="fevereiro">Fevereiro</option>
          <option value="marco">Mar√ßo</option>
          <option value="abril">Abril</option>
          <option value="maio" selected>Maio</option>
          <option value="junho">Junho</option>
          <option value="julho">Julho</option>
          <option value="agosto">Agosto</option>
          <option value="setembro">Setembro</option>
          <option value="outubro">Outubro</option>
          <option value="novembro">Novembro</option>
          <option value="dezembro">Dezembro</option>
        </select>

        <select name="ano" id="ano">
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025" selected>2025</option>
          <option value="2026">2026</option>
        </select>

        <select name="categoria" id="categoria">
          <option value="todas">Todas as Categorias</option>
          <option value="alimentacao">Alimenta√ß√£o</option>
          <option value="transporte">Transporte</option>
          <option value="educacao">Educa√ß√£o</option>
          <option value="moradia">Moradia</option>
          <option value="despesasPessoais">Despesas Pessoais</option>
          <option value="saude">Sa√∫de</option>
          <option value="impostosTarifas">Impostos e Tarifas</option>
          <option value="salario">Sal√°rio</option>
          <option value="aposentadoria">Aposentadoria</option>
          <option value="bolsaEstudos">Bolsa de Estudos</option>
          <option value="aluguel">Aluguel</option>
          <option value="freelance">Freelance</option>
          <option value="vendaProdutos">Venda de Produtos</option>
          <option value="comissoes">Comiss√µes</option>
          <option value="premios">Pr√™mios</option>
          <option value="investimentos">Investimentos</option>
          <option value="presente">Presente</option>
          <option value="doacao">Doa√ß√£o</option>
          <option value="heranca">Heran√ßa</option>
          <option value="outros">Outros</option>
        </select>

        <select name="tipo" id="tipo">
          <option value="todos" selected>Todos os Tipos</option>
          <option value="receita">Receita</option>
          <option value="despesa">Despesa</option>
        </select>

        <button type="submit" class="filter-btn">Filtrar</button>
      </div>
    </form>

    <div class="transactions-table">
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Categoria</th>
            <th>Descri√ß√£o</th>
            <th>Tipo</th>
            <th>Parcelas</th>
            <th>Valor (R$)</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for transacao in transacoes %}
          <tr>
            <td>{{ transacao.data|date:"d/m/Y" }}</td>
            <td>{{ transacao.categoria }}</td>
            <td>{{ transacao.descricao }}</td>
            <td>
              {% if transacao.tipo == 'R' %}
                <span class="tipo-receita">Receita</span>
              {% else %}
                <span class="tipo-despesa">Despesa</span>
              {% endif %}
            </td>
            <td>
              {% if transacao.parcelas > 1 %}
                ({{ transacao.parcela_atual }}/{{ transacao.parcelas }})
              {% else %}
                √Ä vista
              {% endif %}
            </td>
            <td class="{% if transacao.tipo == 'R' %}valor-positivo{% else %}valor-negativo{% endif %}">
              {{ transacao.valor|floatformat:2 }}
            </td>
            <td><a href="javascript:void(0)" class="btn-editar" onclick="editarTransacao('{{ transacao.id }}')">Editar</a></td>
          </tr>
          {% empty %}
          <tr><td colspan="7">Nenhuma transa√ß√£o encontrada.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>
  <div id="modalEditarTransacao" class="modal">
  <div class="modal-content">
    <h2>Editar Transa√ß√£o</h2>
    <form id="formEditarTransacao">
      <label for="data">Data:</label>
      <input type="date" name="data" required>
      <label for="categoria">Categoria:</label>
      <input type="text" name="categoria" required>
      <label for="descricao">Descri√ß√£o:</label>
      <input type="text" name="descricao" required>
      <label for="tipo">Tipo:</label>
      <select name="tipo" required>
        <option value="receita">Receita</option>
        <option value="despesa">Despesa</option>
      </select>
      <label for="parcelas">Parcelas:</label>
      <input type="number" name="parcelas" min="1">
      <label for="valor">Valor:</label>
      <input type="number" name="valor" step="0.01" required>
      <div style="text-align:right;">
        <button type="submit" class="btn-salvar">Salvar</button>
        <button type="button" class="btn-cancelar" onclick="fecharModalHash()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
<script src="{% static 'extrato/js/script.js' %}" defer></script>
</body>
</html>
